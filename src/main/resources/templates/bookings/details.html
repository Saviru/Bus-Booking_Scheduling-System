<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Details - Bus Booking System</title>
</head>
<body>
    <header>
        <h1>Booking Details</h1>
        <nav>
            <a href="/">Home</a>
            <a href="/dashboard">Dashboard</a>
            <a href="/bookings">My Bookings</a>
            <a href="/logout">Logout</a>
        </nav>
    </header>
    
    <main>
        <section>
            <h2>Booking Information</h2>
            
            <div>
                <h3>Booking Reference: <span th:text="${booking.bookingReference}"></span></h3>
                <p>Status: <strong th:text="${booking.statusDisplayName}" 
                                 th:class="${booking.status == T(com.busSystem.BookingSchedule.model.Booking$BookingStatus).CONFIRMED ? 'status-confirmed' :
                                           booking.status == T(com.busSystem.BookingSchedule.model.Booking$BookingStatus).CANCELLED ? 'status-cancelled' :
                                           booking.status == T(com.busSystem.BookingSchedule.model.Booking$BookingStatus).PENDING ? 'status-pending' : ''}"></strong></p>
            </div>
            
            <h3>Travel Details</h3>
            <table border="1">
                <tr>
                    <td><strong>Route:</strong></td>
                    <td th:text="${booking.schedule.route.routeDescription}"></td>
                </tr>
                <tr>
                    <td><strong>Travel Date:</strong></td>
                    <td th:text="${#temporals.format(booking.travelDate, 'EEEE, MMMM dd, yyyy')}"></td>
                </tr>
                <tr>
                    <td><strong>Departure Time:</strong></td>
                    <td th:text="${booking.schedule.departureTime}"></td>
                </tr>
                <tr>
                    <td><strong>Arrival Time:</strong></td>
                    <td th:text="${booking.schedule.arrivalTime}"></td>
                </tr>
                <tr>
                    <td><strong>Bus Number:</strong></td>
                    <td th:text="${booking.schedule.busNumber}"></td>
                </tr>
                <tr>
                    <td><strong>Number of Seats:</strong></td>
                    <td th:text="${booking.numberOfSeats}"></td>
                </tr>
                <tr th:if="${booking.seatNumbers}">
                    <td><strong>Seat Numbers:</strong></td>
                    <td th:text="${booking.seatNumbers}"></td>
                </tr>
                <tr th:if="${booking.seatPreference}">
                    <td><strong>Seat Preference:</strong></td>
                    <td th:text="${booking.seatPreference}"></td>
                </tr>
            </table>
            
            <h3>Payment Information</h3>
            <table border="1">
                <tr>
                    <td><strong>Total Amount:</strong></td>
                    <td th:text="'$' + ${booking.totalAmount}"></td>
                </tr>
                <tr>
                    <td><strong>Payment Method:</strong></td>
                    <td th:text="${booking.paymentMethod}"></td>
                </tr>
                <tr th:if="${booking.paymentReference}">
                    <td><strong>Payment Reference:</strong></td>
                    <td th:text="${booking.paymentReference}"></td>
                </tr>
                <tr th:if="${booking.refundAmount}">
                    <td><strong>Refund Amount:</strong></td>
                    <td th:text="'$' + ${booking.refundAmount}"></td>
                </tr>
            </table>
            
            <h3>Booking History</h3>
            <table border="1">
                <tr>
                    <td><strong>Booking Date:</strong></td>
                    <td th:text="${#temporals.format(booking.bookingDate, 'MMM dd, yyyy HH:mm')}"></td>
                </tr>
                <tr>
                    <td><strong>Last Modified:</strong></td>
                    <td th:text="${#temporals.format(booking.lastModified, 'MMM dd, yyyy HH:mm')}"></td>
                </tr>
                <tr th:if="${booking.refundProcessedAt}">
                    <td><strong>Refund Processed:</strong></td>
                    <td th:text="${#temporals.format(booking.refundProcessedAt, 'MMM dd, yyyy HH:mm')}"></td>
                </tr>
            </table>
            
            <div th:if="${booking.specialRequests}">
                <h3>Special Requests</h3>
                <p th:text="${booking.specialRequests}"></p>
            </div>
            
            <div th:if="${booking.cancellationReason}">
                <h3>Cancellation Reason</h3>
                <p th:text="${booking.cancellationReason}"></p>
            </div>
        </section>
        
        <section>
            <h3>Actions</h3>
            
            <div th:if="${booking.status == T(com.busSystem.BookingSchedule.model.Booking$BookingStatus).PENDING}">
                <form method="post" th:action="@{/bookings/{id}/confirm(id=${booking.id})}" style="display: inline;">
                    <label for="paymentReference">Payment Reference:</label>
                    <input type="text" name="paymentReference" id="paymentReference" required>
                    <button type="submit">Confirm Payment</button>
                </form>
            </div>
            
            <div th:if="${booking.canBeModified()}">
                <a th:href="@{/bookings/{id}/edit(id=${booking.id})}">
                    <button type="button">Edit Booking</button>
                </a>
            </div>
            
            <div th:if="${booking.canBeCancelled()}">
                <form method="post" th:action="@{/bookings/{id}/cancel(id=${booking.id})}" style="display: inline;">
                    <label for="reason">Cancellation Reason:</label>
                    <input type="text" name="reason" id="reason" placeholder="Optional reason">
                    <button type="submit" onclick="return confirm('Are you sure you want to cancel this booking? Refund amount: $' + [[${booking.calculateRefundAmount()}]] + ')')">
                        Cancel Booking
                    </button>
                </form>
                <p><small>Refund Amount: $<span th:text="${booking.calculateRefundAmount()}"></span></small></p>
            </div>
            
            <div th:if="${booking.status == T(com.busSystem.BookingSchedule.model.Booking$BookingStatus).CANCELLED}">
                <form method="post" th:action="@{/bookings/{id}/delete(id=${booking.id})}" style="display: inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to permanently delete this booking?')">
                        Delete Booking
                    </button>
                </form>
            </div>
            
            <a href="/bookings">
                <button type="button">Back to Bookings</button>
            </a>
        </section>
    </main>
    
    <div th:if="${success}">
        <p style="color: green;" th:text="${success}"></p>
    </div>
    
    <div th:if="${error}">
        <p style="color: red;" th:text="${error}"></p>
    </div>
</body>
</html>