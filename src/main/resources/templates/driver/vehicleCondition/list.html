<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Vehicle Condition Reports</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Vehicle Condition Reports</h1>
    
    <div th:if="${successMessage}" th:text="${successMessage}"></div>
    
    <div>
        <a href="/">Home</a> | 
        <a href="/driver/vehicle-reports/create">Submit New Report</a> |
        <a href="/driver/vehicle-reports/search">Advanced Search</a>
    </div>
    
    <div>
        <h3>Filter Reports</h3>
        <form action="/driver/vehicle-reports" method="get">
            <div>
                <label for="vehicleNumber">Vehicle Number:</label>
                <input type="text" id="vehicleNumber" name="vehicleNumber">
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/driver/vehicle-reports" method="get">
            <div>
                <label for="driverId">Driver ID:</label>
                <input type="text" id="driverId" name="driverId">
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/driver/vehicle-reports" method="get">
            <div>
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="">All</option>
                    <option value="PENDING">Pending</option>
                    <option value="REVIEWED">Reviewed</option>
                    <option value="IN_REPAIR">In Repair</option>
                    <option value="RESOLVED">Resolved</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/driver/vehicle-reports" method="get">
            <div>
                <label for="reportType">Report Type:</label>
                <select id="reportType" name="reportType">
                    <option value="">All</option>
                    <option value="PRE_TRIP">Pre-Trip</option>
                    <option value="POST_TRIP">Post-Trip</option>
                    <option value="MAINTENANCE_REQUEST">Maintenance Request</option>
                    <option value="INCIDENT">Incident</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/driver/vehicle-reports" method="get">
            <div>
                <label for="date">Date:</label>
                <input type="date" id="date" name="date" th:value="${today}">
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/driver/vehicle-reports" method="get">
            <div>
                <input type="hidden" id="needsAttention" name="needsAttention" value="true">
                <button type="submit">Show Reports Needing Attention</button>
            </div>
        </form>
    </div>
    
    <div th:if="${filterType != null}">
        <p>Filtering by <span th:text="${filterType}"></span>: <span th:text="${filterValue}"></span></p>
        <a href="/driver/vehicle-reports">Clear Filter</a>
    </div>
    
    <!-- Vehicle summary if filtering by vehicle -->
    <div th:if="${summary != null}">
        <h3>Vehicle Summary</h3>
        <table border="1">
            <tr>
                <th>Total Reports</th>
                <td th:text="${summary.totalReports}"></td>
            </tr>
            <tr>
                <th>Needs Attention</th>
                <td th:text="${summary.needsAttention}"></td>
            </tr>
            <tr>
                <th>Brake Issues</th>
                <td th:text="${summary.brakeIssues}"></td>
            </tr>
            <tr>
                <th>Light Issues</th>
                <td th:text="${summary.lightIssues}"></td>
            </tr>
            <tr>
                <th>Tire Issues</th>
                <td th:text="${summary.tireIssues}"></td>
            </tr>
        </table>
    </div>
    
    <table border="1">
        <thead>
            <tr>
                <th>Date</th>
                <th>Vehicle</th>
                <th>Driver</th>
                <th>Report Type</th>
                <th>Brakes</th>
                <th>Lights</th>
                <th>Tires</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:if="${reports.empty}">
                <td colspan="9">No vehicle condition reports found</td>
            </tr>
            <tr th:each="report : ${reports}">
                <td th:text="${report.reportDate}"></td>
                <td th:text="${report.vehicleNumber}"></td>
                <td th:text="${report.driverName + (report.driverId != null ? ' (' + report.driverId + ')' : '')}"></td>
                <td th:text="${report.reportType}"></td>
                <td th:text="${report.brakesCondition}" th:style="${report.brakesCondition == 'NEEDS_ATTENTION' || report.brakesCondition == 'POOR' ? 'color: red;' : ''}"></td>
                <td th:text="${report.lightsCondition}" th:style="${report.lightsCondition == 'NEEDS_ATTENTION' || report.lightsCondition == 'POOR' ? 'color: red;' : ''}"></td>
                <td th:text="${report.tiresCondition}" th:style="${report.tiresCondition == 'NEEDS_ATTENTION' || report.tiresCondition == 'POOR' ? 'color: red;' : ''}"></td>
                <td th:text="${report.status}"></td>
                <td>
                    <a th:href="@{/driver/vehicle-reports/{id}(id=${report.id})}">View</a> |
                    <a th:href="@{/driver/vehicle-reports/{id}/edit(id=${report.id})}">Edit</a> |
                    <a th:href="@{/driver/vehicle-reports/{id}/update-status(id=${report.id})}">Update Status</a> |
                    <a th:href="@{/driver/vehicle-reports/{id}/delete(id=${report.id})}"
                       onclick="return confirm('Are you sure you want to delete this report?')">Delete</a>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>