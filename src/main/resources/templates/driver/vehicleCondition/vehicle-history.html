<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Vehicle History</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Vehicle History: <span th:text="${vehicleNumber}"></span></h1>
    
    <div>
        <a href="/driver/vehicle-reports">Back to Reports</a>
    </div>
    
    <div>
        <h3>Vehicle Summary</h3>
        <table border="1">
            <tr>
                <th>Total Reports</th>
                <td th:text="${summary.totalReports}"></td>
            </tr>
            <tr>
                <th>Needs Attention</th>
                <td th:text="${summary.needsAttention}"></td>
            </tr>
            <tr>
                <th>Brake Issues</th>
                <td th:text="${summary.brakeIssues}"></td>
            </tr>
            <tr>
                <th>Light Issues</th>
                <td th:text="${summary.lightIssues}"></td>
            </tr>
            <tr>
                <th>Tire Issues</th>
                <td th:text="${summary.tireIssues}"></td>
            </tr>
            <tr th:if="${summary.PENDING != null}">
                <th>Pending Reports</th>
                <td th:text="${summary.PENDING}"></td>
            </tr>
            <tr th:if="${summary.REVIEWED != null}">
                <th>Reviewed Reports</th>
                <td th:text="${summary.REVIEWED}"></td>
            </tr>
            <tr th:if="${summary.IN_REPAIR != null}">
                <th>In Repair</th>
                <td th:text="${summary.IN_REPAIR}"></td>
            </tr>
            <tr th:if="${summary.RESOLVED != null}">
                <th>Resolved Issues</th>
                <td th:text="${summary.RESOLVED}"></td>
            </tr>
        </table>
    </div>
    
    <h3>Report History</h3>
    <table border="1">
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Odometer</th>
                <th>Driver</th>
                <th>Issues</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr th:if="${reports.empty}">
                <td colspan="7">No reports found for this vehicle</td>
            </tr>
            <tr th:each="report : ${reports}">
                <td th:text="${report.reportDate}"></td>
                <td th:text="${report.reportType}"></td>
                <td th:text="${report.odometerReading != null ? report.odometerReading + ' km' : 'N/A'}"></td>
                <td th:text="${report.driverName}"></td>
                <td>
                    <span th:if="${report.hasIssues()}" style="color: red;">Yes</span>
                    <span th:unless="${report.hasIssues()}">No</span>
                </td>
                <td th:text="${report.status}"></td>
                <td>
                    <a th:href="@{/driver/vehicle-reports/{id}(id=${report.id})}">View</a>
                </td>
            </tr>
        </tbody>
    </table>
    
    <div th:if="${!reports.empty}">
        <h3>Maintenance Timeline</h3>
        <ul>
            <li th:each="report : ${reports}" th:if="${report.status == 'RESOLVED' || report.status == 'IN_REPAIR'}">
                <span th:text="${report.reportDate}"></span>: 
                <span th:text="${report.status}"></span> - 
                <span th:text="${report.followUpAction != null ? report.followUpAction : 'No details available'}"></span>
            </li>
            <li th:if="${reports.stream().noneMatch(r -> r.getStatus() == 'RESOLVED' || r.getStatus() == 'IN_REPAIR')}">
                No maintenance history available
            </li>
        </ul>
    </div>
    
    <div>
        <h3>Actions</h3>
        <a th:href="@{/driver/vehicle-reports/create?vehicleNumber={vn}(vn=${vehicleNumber})}">Submit New Report for this Vehicle</a>
    </div>
</body>
</html>