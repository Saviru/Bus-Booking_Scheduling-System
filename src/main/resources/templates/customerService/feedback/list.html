<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Feedback Management</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Feedback Management</h1>
    
    <div th:if="${successMessage}" th:text="${successMessage}"></div>
    
    <div>
        <a href="/">Home</a> | 
        <a href="/customer-service/feedback/create">Record New Feedback</a> |
        <a href="/customer-service/feedback/analytics">Feedback Analytics</a> |
        <a href="/customer-service/feedback/search">Advanced Search</a>
    </div>
    
    <div>
        <h3>Overall Average Rating: <span th:text="${#numbers.formatDecimal(averageRating != null ? averageRating : 0, 1, 2)}"></span> / 5</h3>
    </div>
    
    <div>
        <h3>Filter Feedback</h3>
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="rating">Exact Rating:</label>
                <select id="rating" name="rating">
                    <option value="">Any</option>
                    <option value="1">1 Star</option>
                    <option value="2">2 Stars</option>
                    <option value="3">3 Stars</option>
                    <option value="4">4 Stars</option>
                    <option value="5">5 Stars</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="minRating">Minimum Rating:</label>
                <select id="minRating" name="minRating">
                    <option value="">Any</option>
                    <option value="3">3 Stars & Above</option>
                    <option value="4">4 Stars & Above</option>
                    <option value="5">5 Stars Only</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="maxRating">Maximum Rating:</label>
                <select id="maxRating" name="maxRating">
                    <option value="">Any</option>
                    <option value="2">2 Stars & Below</option>
                    <option value="3">3 Stars & Below</option>
                    <option value="4">4 Stars & Below</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="routeId">Route ID:</label>
                <input type="text" id="routeId" name="routeId">
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="customerName">Customer Name:</label>
                <input type="text" id="customerName" name="customerName">
                <button type="submit">Search</button>
            </div>
        </form>
        
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="reviewed">Review Status:</label>
                <select id="reviewed" name="reviewed">
                    <option value="">All</option>
                    <option value="true">Reviewed</option>
                    <option value="false">Not Reviewed</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
        
        <form action="/customer-service/feedback" method="get">
            <div>
                <label for="feedbackType">Feedback Type:</label>
                <select id="feedbackType" name="feedbackType">
                    <option value="">All</option>
                    <option value="GENERAL">General</option>
                    <option value="SUGGESTION">Suggestion</option>
                    <option value="COMPLIMENT">Compliment</option>
                    <option value="COMPLAINT">Complaint</option>
                </select>
                <button type="submit">Filter</button>
            </div>
        </form>
    </div>
    
    <div th:if="${filterType != null}">
        <p>Filtering by <span th:text="${filterType}"></span>: <span th:text="${filterValue}"></span></p>
        <a href="/customer-service/feedback">Clear Filter</a>
    </div>
    
    <table border="1">
        <thead>
            <tr>
                <th>Customer</th>
                <th>Date</th>
                <th>Rating</th>
                <th>Type</th>
                <th>Route</th>
                <th>Reviewed</th>
                <th>Tags</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:if="${feedback.empty}">
                <td colspan="8">No feedback found</td>
            </tr>
            <tr th:each="item : ${feedback}">
                <td th:text="${item.customerName}"></td>
                <td th:text="${item.submissionDate}"></td>
                <td>
                    <span th:text="${item.rating}"></span> Stars
                </td>
                <td th:text="${item.feedbackType}"></td>
                <td th:text="${item.routeId != null ? item.routeId : 'N/A'}"></td>
                <td th:text="${item.reviewed ? 'Yes' : 'No'}"></td>
                <td th:text="${item.tags != null ? item.tags : ''}"></td>
                <td>
                    <a th:href="@{/customer-service/feedback/{id}(id=${item.id})}">View</a> |
                    <a th:href="@{/customer-service/feedback/{id}/edit(id=${item.id})}">Edit</a> |
                    <a th:if="${!item.reviewed}" th:href="@{/customer-service/feedback/{id}/mark-reviewed(id=${item.id})}">Mark Reviewed</a>
                    <span th:if="${item.reviewed}">Reviewed</span> |
                    <a th:href="@{/customer-service/feedback/{id}/add-tags(id=${item.id})}">Add Tags</a> |
                    <a th:href="@{/customer-service/feedback/{id}/delete(id=${item.id})}"
                       onclick="return confirm('Are you sure you want to delete this feedback?')">Delete</a>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>